<!DOCTYPE html><html lang="en"><meta charset="utf-8">
<body>
<div id="videos"></div>
<script type="module">
import {joinRoom, selfId} from 'https://esm.run/trystero';
const room = joinRoom({appId: 'yellowscreen.neocities.org'}, 'testing-video');

const peerVideos = {};
const peerAudios = {};
const videoContainer = document.getElementById('videos');

const selfStream = await navigator.mediaDevices.getUserMedia({
  audio: true,
  video: true});

// send stream to peers currently in the room
room.addStream(selfStream);

// send stream to peers who join later
room.onPeerJoin(peerId => room.addStream(selfStream, peerId));

room.onPeerStream((stream, peerId) => {
	let video = peerVideos[peerId];

	// if this peer hasn't sent a stream before, create a video element
	if (!video) {
		video = document.createElement('video');
		video.autoplay = true;

		// add video element to the DOM
		videoContainer.appendChild(video);
	}

	video.srcObject = stream;
	peerVideos[peerId] = video;
})
</script>
